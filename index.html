<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viagem ao Centro da Terra - Jogo Educacional BNCC</title>
    <style>
        /* Reset e Vari√°veis */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #4A90E2;
            --secondary-color: #FF6347;
            --text-color: #333;
            --bg-color: #F5F5F5;
            --card-bg: #FFFFFF;
            --success-color: #28A745;
            --warning-color: #FFC107;
            --crosta-color: #8B4513;
            --manto-color: #FF4500;
            --nucleo-color: #FFD700;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* Modo Alto Contraste */
        .alto-contraste {
            --text-color: #FFFFFF;
            --bg-color: #000000;
            --card-bg: #1A1A1A;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        /* Tamanhos de Fonte */
        .fonte-pequena { font-size: 14px; }
        .fonte-media { font-size: 16px; }
        .fonte-grande { font-size: 20px; }

        /* Container Principal */
        #game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        /* Telas */
        .tela {
            display: none;
            animation: fadeIn 0.5s;
        }

        .tela.ativa {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Tela Inicial */
        #menu-inicial {
            text-align: center;
            padding: 40px 20px;
        }

        #menu-inicial h1 {
            font-size: 3em;
            margin-bottom: 30px;
            color: var(--primary-color);
        }

        #menu-inicial p {
            font-size: 1.2em;
            margin-bottom: 40px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Bot√µes */
        .btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
            box-shadow: var(--shadow);
        }

        .btn:hover {
            background: #357ABD;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.15);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:focus {
            outline: 3px solid var(--warning-color);
            outline-offset: 2px;
        }

        .btn-secundario {
            background: var(--secondary-color);
        }

        .btn-secundario:hover {
            background: #E5533A;
        }

        /* Sele√ß√£o de Personagem */
        .personagens-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin: 40px 0;
        }

        .card-personagem {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: var(--shadow);
            border: 3px solid transparent;
        }

        .card-personagem:hover {
            transform: translateY(-5px);
            border-color: var(--primary-color);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .card-personagem.selecionado {
            border-color: var(--success-color);
            background: #E8F5E9;
        }

        .card-personagem .emoji-personagem {
            font-size: 5em;
            margin-bottom: 20px;
        }

        .card-personagem h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .card-personagem p {
            color: #666;
            margin-bottom: 20px;
        }

        /* HUD do Jogo */
        #hud {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--card-bg);
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        #hud button {
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
        }

        #hud button:hover {
            background: var(--primary-color);
            color: white;
        }

        /* Conte√∫do da Fase */
        #conteudo-fase {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .fase-titulo {
            font-size: 2em;
            margin-bottom: 20px;
            color: var(--primary-color);
            text-align: center;
        }

        .fase-descricao {
            font-size: 1.1em;
            margin-bottom: 30px;
            text-align: center;
            color: #666;
        }

        /* Elementos Interativos */
        .elementos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .elemento-interativo {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: var(--shadow);
            min-height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .elemento-interativo:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .elemento-interativo .emoji {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .elemento-interativo h4 {
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal.ativo {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-conteudo {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .modal-fechar {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #ff4444;
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-fechar:hover {
            background: #cc0000;
        }

        /* Di√°rio */
        .diario-abas {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
        }

        .diario-aba {
            padding: 10px 20px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 1em;
            color: var(--text-color);
            transition: all 0.3s;
        }

        .diario-aba.ativa {
            border-bottom-color: var(--primary-color);
            color: var(--primary-color);
            font-weight: bold;
        }

        .diario-aba:hover {
            color: var(--primary-color);
        }

        .diario-conteudo {
            min-height: 300px;
        }

        .amostra-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary-color);
        }

        .amostra-item h4 {
            color: var(--primary-color);
            margin-bottom: 8px;
        }

        /* Quiz */
        .quiz-pergunta {
            font-size: 1.2em;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .quiz-opcoes {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .quiz-opcao {
            background: #f8f9fa;
            border: 2px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quiz-opcao:hover {
            border-color: var(--primary-color);
            background: #e3f2fd;
        }

        .quiz-opcao.correta {
            background: #c8e6c9;
            border-color: var(--success-color);
        }

        .quiz-opcao.incorreta {
            background: #ffcdd2;
            border-color: #f44336;
        }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            background: #e3f2fd;
            border-left: 4px solid var(--primary-color);
        }

        .feedback.erro {
            background: #ffebee;
            border-left-color: #f44336;
        }

        .feedback.sucesso {
            background: #e8f5e9;
            border-left-color: var(--success-color);
        }

        /* Barra de Progresso */
        #barra-progresso {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
        }

        .progresso-container {
            background: #e0e0e0;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .progresso-bar {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            height: 100%;
            width: 0%;
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        /* Menu de Op√ß√µes */
        .opcoes-grid {
            display: grid;
            gap: 20px;
            margin-top: 20px;
        }

        .opcao-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 30px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary-color);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }

        /* Conquistas */
        .conquista-item {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .conquista-item .emoji {
            font-size: 2em;
        }

        /* Galeria de F√≥sseis */
        .fossil-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .fossil-card {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: all 0.3s;
        }

        .fossil-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .fossil-card .emoji {
            font-size: 4em;
            margin-bottom: 15px;
        }

        /* Tela Final */
        .tela-final {
            text-align: center;
            padding: 40px;
        }

        .tela-final h1 {
            font-size: 3em;
            color: var(--success-color);
            margin-bottom: 20px;
        }

        .certificado {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 12px;
            margin: 30px 0;
            box-shadow: var(--shadow);
        }

        /* Responsivo */
        @media (max-width: 768px) {
            #menu-inicial h1 {
                font-size: 2em;
            }

            .personagens-grid {
                grid-template-columns: 1fr;
            }

            .elementos-grid {
                grid-template-columns: 1fr;
            }

            #hud {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* Utilit√°rios */
        .texto-centro {
            text-align: center;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .escondido {
            display: none !important;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <!-- Tela Inicial -->
        <div id="menu-inicial" class="tela ativa">
            <h1>üåç Viagem ao Centro da Terra</h1>
            <p>Voc√™ √© um(a) cientista brasileiro(a) que descobriu uma caverna especial na Chapada Diamantina. Ela vai muito fundo e passa por todas as camadas da Terra! Sua miss√£o √© descer, investigar cada camada e documentar tudo que encontrar. Prepare-se para a aventura cient√≠fica da sua vida!</p>
            <button class="btn" onclick="mostrarSelecaoPersonagem()">üöÄ Iniciar Jogo</button>
            <button class="btn btn-secundario" onclick="abrirOpcoes()">‚öôÔ∏è Op√ß√µes</button>
            <button class="btn" onclick="carregarJogoSalvo()" id="btn-continuar" style="display: none;">üìÇ Continuar Jogo</button>
        </div>

        <!-- Sele√ß√£o de Personagem -->
        <div id="selecao-personagem" class="tela">
            <h2 class="texto-centro mb-20">Escolha seu personagem cientista:</h2>
            <div class="personagens-grid">
                <div class="card-personagem" onclick="selecionarPersonagem('joaquim')" tabindex="0" onkeypress="if(event.key==='Enter') selecionarPersonagem('joaquim')">
                    <div class="emoji-personagem">üßëüèø‚Äçüî¨</div>
                    <h3>Dr. Joaquim Santos</h3>
                    <p><strong>Ge√≥logo</strong></p>
                    <p>Especialista em rochas e estruturas geol√≥gicas. Apaixonado por descobrir os segredos das camadas da Terra.</p>
                    <button class="btn mt-20">Escolher</button>
                </div>
                <div class="card-personagem" onclick="selecionarPersonagem('dandara')" tabindex="0" onkeypress="if(event.key==='Enter') selecionarPersonagem('dandara')">
                    <div class="emoji-personagem">üë©üèø‚Äçüî¨</div>
                    <h3>Dra. Dandara Costa</h3>
                    <p><strong>Paleont√≥loga</strong></p>
                    <p>Especialista em f√≥sseis e vida antiga. Fascinada pelos seres que viveram h√° milh√µes de anos na Am√©rica do Sul.</p>
                    <button class="btn mt-20">Escolher</button>
                </div>
            </div>
        </div>

        <!-- Tela do Jogo -->
        <div id="jogo" class="tela">
            <header id="hud">
                <div>
                    <span id="info-personagem"></span> | 
                    <span id="fase-atual"></span>
                </div>
                <div>
                    <button onclick="abrirDiario()" tabindex="0">üìñ Di√°rio</button>
                    <button onclick="abrirOpcoes()" tabindex="0">‚ò∞ Menu</button>
                </div>
            </header>

            <main id="conteudo-fase">
                <!-- Conte√∫do din√¢mico -->
            </main>

            <footer id="barra-progresso">
                <div class="progresso-container">
                    <div class="progresso-bar" id="progresso-bar">0%</div>
                </div>
            </footer>
        </div>

        <!-- Modal do Di√°rio -->
        <div id="modal-diario" class="modal" tabindex="-1">
            <div class="modal-conteudo">
                <button class="modal-fechar" onclick="fecharDiario()" aria-label="Fechar">√ó</button>
                <h2>üìñ Di√°rio Cient√≠fico</h2>
                <div class="diario-abas">
                    <button class="diario-aba ativa" onclick="mostrarAbaDiario('descobertas')">üìù Descobertas</button>
                    <button class="diario-aba" onclick="mostrarAbaDiario('amostras')">üî¨ Amostras</button>
                    <button class="diario-aba" onclick="mostrarAbaDiario('mapa')">üó∫Ô∏è Mapa</button>
                    <button class="diario-aba" onclick="mostrarAbaDiario('glossario')">üìö Gloss√°rio</button>
                </div>
                <div class="diario-conteudo" id="diario-conteudo">
                    <!-- Conte√∫do din√¢mico -->
                </div>
            </div>
        </div>

        <!-- Modal de Quiz/Valida√ß√£o -->
        <div id="modal-quiz" class="modal" tabindex="-1">
            <div class="modal-conteudo">
                <button class="modal-fechar" onclick="fecharQuiz()" aria-label="Fechar">√ó</button>
                <div id="quiz-conteudo">
                    <!-- Conte√∫do din√¢mico -->
                </div>
            </div>
        </div>

        <!-- Modal de Op√ß√µes -->
        <div id="modal-opcoes" class="modal" tabindex="-1">
            <div class="modal-conteudo">
                <button class="modal-fechar" onclick="fecharOpcoes()" aria-label="Fechar">√ó</button>
                <h2>‚öôÔ∏è Op√ß√µes</h2>
                <div class="opcoes-grid">
                    <div class="opcao-item">
                        <div>
                            <strong>Alto Contraste</strong>
                            <p>Melhora a visibilidade</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggle-contraste" onchange="toggleAltoContraste()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="opcao-item">
                        <div>
                            <strong>Tamanho da Fonte</strong>
                            <p>Ajuste o tamanho do texto</p>
                        </div>
                        <div>
                            <button class="btn" onclick="ajustarFonte('pequena')">A-</button>
                            <button class="btn" onclick="ajustarFonte('media')">A</button>
                            <button class="btn" onclick="ajustarFonte('grande')">A+</button>
                        </div>
                    </div>
                    <div class="opcao-item">
                        <div>
                            <strong>Recome√ßar Jogo</strong>
                            <p>Apaga o progresso salvo</p>
                        </div>
                        <button class="btn btn-secundario" onclick="recomecarJogo()">üîÑ Recome√ßar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Estado do Jogo
        let jogo = {
            personagem: null,
            faseAtual: 1,
            fasesCompletas: [],
            amostras: [],
            fosseis: [],
            conquistas: [],
            progresso: 0,
            elementosInvestigados: []
        };

        // Dados Cient√≠ficos
        const personagens = {
            joaquim: {
                nome: "Dr. Joaquim Santos",
                profissao: "Ge√≥logo",
                emoji: "üßëüèø‚Äçüî¨"
            },
            dandara: {
                nome: "Dra. Dandara Costa",
                profissao: "Paleont√≥loga",
                emoji: "üë©üèø‚Äçüî¨"
            }
        };

        const camadasTerra = {
            1: {
                nome: "Crosta Terrestre",
                descricao: "A camada mais externa e fina da Terra, onde vivemos. √â formada por rochas, solo e minerais.",
                temperatura: "15¬∞C a 400¬∞C",
                profundidade: "5-70 km",
                cor: "#8B4513",
                elementos: [
                    { id: "rocha-sedimentar", nome: "Rocha Sedimentar", emoji: "ü™®", info: "Rocha formada pelo ac√∫mulo de sedimentos ao longo de milh√µes de anos. √â a √öNICA rocha que pode conter f√≥sseis!" },
                    { id: "fossil-glossopteris", nome: "F√≥ssil de Glossopteris", emoji: "üçÉ", info: "Folha f√≥ssil de planta antiga que prova que os continentes estavam unidos no passado. Encontrado no Brasil!" },
                    { id: "fossil-staurikosaurus", nome: "F√≥ssil de Staurikosaurus", emoji: "ü¶ï", info: "Um dos dinossauros mais antigos do mundo! Era pequeno, carn√≠voro e viveu no que hoje √© o Rio Grande do Sul, Brasil." },
                    { id: "fossil-santanaraptor", nome: "F√≥ssil de Santanaraptor", emoji: "ü¶ñ", info: "Dinossauro carn√≠voro encontrado no Brasil! Tinha penas e era parente do famoso Velociraptor. Encontrado no Cear√°!" },
                    { id: "fossil-mesosaurus", nome: "F√≥ssil de Mesosaurus", emoji: "üêä", info: "R√©ptil aqu√°tico que viveu quando a Am√©rica do Sul e √Åfrica estavam unidas. Prova a deriva continental!" },
                    { id: "fossil-pterossauros", nome: "F√≥ssil de Pterossauros", emoji: "ü¶Ö", info: "R√©pteis voadores que dominaram os c√©us! O Brasil tem alguns dos melhores f√≥sseis de pterossauros do mundo, especialmente no Cear√°." },
                    { id: "fossil-trilobitas", nome: "F√≥ssil de Trilobitas", emoji: "ü¶Ä", info: "Bichos marinhos muito antigos, extintos h√° 250 milh√µes de anos. Foram muito importantes na evolu√ß√£o da vida!" },
                    { id: "fossil-amonites", nome: "F√≥ssil de Amonites", emoji: "üêö", info: "Moluscos extintos em formato de espiral. Muito comuns em rochas sedimentares!" },
                    { id: "solo", nome: "Solo e Minerais", emoji: "üî®", info: "O solo √© formado pela decomposi√ß√£o de rochas e mat√©ria org√¢nica. √â essencial para a vida na Terra." },
                    { id: "placa", nome: "Placa Informativa", emoji: "üìä", info: "A crosta continental √© mais espessa (at√© 70km) e forma os continentes. A crosta oce√¢nica √© mais fina (5-10km) e est√° sob os oceanos." }
                ],
                rochas: ["sedimentar"],
                fosseis: ["glossopteris", "staurikosaurus", "santanaraptor", "mesosaurus", "pterossauros", "trilobitas", "amonites"]
            },
            2: {
                nome: "Manto Superior",
                descricao: "Camada intermedi√°ria onde rochas sofrem transforma√ß√µes devido ao calor e press√£o intensos.",
                temperatura: "1.000¬∞C a 2.000¬∞C",
                profundidade: "70-700 km",
                cor: "#FF6347",
                elementos: [
                    { id: "temperatura", nome: "Indicador de Temperatura", emoji: "üå°Ô∏è", info: "A temperatura aumenta drasticamente! Aqui faz mais de 1.000¬∞C. O calor transforma as rochas." },
                    { id: "marmore", nome: "M√°rmore", emoji: "ü™®", info: "Rocha metam√≥rfica! Era calc√°rio, mas o calor e press√£o a transformaram em m√°rmore. N√£o derreteu, apenas mudou de forma." },
                    { id: "ardosia", nome: "Ard√≥sia", emoji: "ü™®", info: "Rocha metam√≥rfica formada a partir da argila. Usada para fazer telhas e lousas." },
                    { id: "pressao", nome: "Gr√°fico de Press√£o", emoji: "üìà", info: "A press√£o aqui √© enorme! Milhares de vezes maior que na superf√≠cie. Isso, junto com o calor, transforma rochas em rochas metam√≥rficas." }
                ],
                rochas: ["marmore", "ardosia"]
            },
            3: {
                nome: "Manto Inferior",
                descricao: "Zona de magma em movimento que causa terremotos, vulc√µes e forma rochas magm√°ticas.",
                temperatura: "2.000¬∞C a 3.700¬∞C",
                profundidade: "700-2.900 km",
                cor: "#FF4500",
                elementos: [
                    { id: "magma", nome: "Magma em Movimento", emoji: "üåã", info: "O magma √© rocha derretida que se move lentamente. Esse movimento causa as placas tect√¥nicas a se moverem!" },
                    { id: "rocha-magmatica", nome: "Rochas Magm√°ticas", emoji: "ü™®", info: "Quando o magma esfria e endurece, forma rochas magm√°ticas (ou √≠gneas). Exemplos: granito e basalto." },
                    { id: "tectonica", nome: "Simula√ß√£o de Tect√¥nica", emoji: "üåç", info: "O movimento do magma empurra as placas tect√¥nicas, causando terremotos e vulc√µes na superf√≠cie!" },
                    { id: "termometro", nome: "Term√¥metro Extremo", emoji: "üå°Ô∏è", info: "Aqui a temperatura pode chegar a 3.700¬∞C! Quase t√£o quente quanto a superf√≠cie do Sol!" }
                ],
                rochas: ["granito", "basalto"]
            },
            4: {
                nome: "N√∫cleo Externo",
                descricao: "Camada de metal l√≠quido (ferro e n√≠quel) que cria o campo magn√©tico da Terra.",
                temperatura: "4.000¬∞C a 5.000¬∞C",
                profundidade: "2.900-5.100 km",
                cor: "#FFD700",
                elementos: [
                    { id: "campo-magnetico", nome: "Campo Magn√©tico", emoji: "üß≤", info: "O movimento do metal l√≠quido cria o campo magn√©tico da Terra, que nos protege dos ventos solares perigosos!" },
                    { id: "metal-liquido", nome: "Metal L√≠quido", emoji: "üåä", info: "Aqui h√° ferro e n√≠quel derretidos, movendo-se constantemente. √â como um oceano de metal l√≠quido!" },
                    { id: "protecao-solar", nome: "Prote√ß√£o Solar", emoji: "‚òÄÔ∏è", info: "O campo magn√©tico desvia part√≠culas perigosas do Sol, protegendo toda a vida na Terra!" },
                    { id: "temp-extrema", nome: "Temperatura Extrema", emoji: "üå°Ô∏è", info: "A temperatura aqui √© de 4.000¬∞C a 5.000¬∞C! Mais quente que a superf√≠cie do Sol!" }
                ],
                rochas: []
            },
            5: {
                nome: "N√∫cleo Interno",
                descricao: "O centro s√≥lido da Terra, formado por ferro e n√≠quel sob press√£o extrema.",
                temperatura: "5.000¬∞C a 6.000¬∞C",
                profundidade: "5.100-6.371 km",
                cor: "#C0C0C0",
                elementos: [
                    { id: "nucleo-solido", nome: "N√∫cleo S√≥lido", emoji: "üíé", info: "Apesar de estar a 6.000¬∞C, o n√∫cleo interno √© S√ìLIDO! A press√£o extrema mant√©m o metal s√≥lido." },
                    { id: "pressao-extrema", nome: "Press√£o Extrema", emoji: "‚öñÔ∏è", info: "A press√£o aqui √© milh√µes de vezes maior que na superf√≠cie! √â isso que mant√©m o n√∫cleo s√≥lido mesmo t√£o quente." },
                    { id: "temp-maxima", nome: "Temperatura M√°xima", emoji: "üî•", info: "6.000¬∞C! A temperatura mais alta do planeta. Mais quente que a superf√≠cie do Sol!" },
                    { id: "revisao", nome: "Revis√£o Completa", emoji: "üåç", info: "Parab√©ns! Voc√™ chegou ao centro da Terra! Revise tudo que aprendeu sobre as camadas, rochas e f√≥sseis." }
                ],
                rochas: []
            }
        };

        const tiposRochas = {
            sedimentar: {
                nome: "Rocha Sedimentar",
                formacao: "Formada pelo ac√∫mulo e compacta√ß√£o de sedimentos ao longo de milh√µes de anos",
                exemplos: ["Calc√°rio", "Arenito", "Carv√£o"],
                temFosseis: true,
                emoji: "ü™®"
            },
            metamorfica: {
                nome: "Rocha Metam√≥rfica",
                formacao: "Formada quando outras rochas sofrem transforma√ß√µes por calor e press√£o intensos",
                exemplos: ["M√°rmore (era calc√°rio)", "Ard√≥sia (era argila)", "Gnaisse (era granito)"],
                temFosseis: false,
                emoji: "ü™®"
            },
            magmatica: {
                nome: "Rocha Magm√°tica (√çgnea)",
                formacao: "Formada quando o magma esfria e endurece",
                exemplos: ["Granito", "Basalto"],
                temFosseis: false,
                emoji: "ü™®"
            }
        };

        const fosseisSulAmericanos = [
            {
                nome: "Glossopteris",
                tipo: "Planta",
                periodo: "Permiano (299-252 milh√µes de anos)",
                local: "Brasil, Argentina",
                info: "Folha f√≥ssil que prova que os continentes estavam unidos. Foi encontrada na Am√©rica do Sul, √Åfrica, √çndia e Ant√°rtida!",
                emoji: "üçÉ"
            },
            {
                nome: "Staurikosaurus",
                tipo: "Dinossauro",
                periodo: "Tri√°ssico (233-225 milh√µes de anos)",
                local: "Rio Grande do Sul, Brasil",
                info: "Um dos dinossauros mais antigos do mundo! Era pequeno, carn√≠voro e viveu no que hoje √© o Brasil.",
                emoji: "ü¶ï"
            },
            {
                nome: "Santanaraptor",
                tipo: "Dinossauro",
                periodo: "Cret√°ceo (112-100 milh√µes de anos)",
                local: "Cear√°, Brasil",
                info: "Dinossauro carn√≠voro encontrado no Brasil! Tinha penas e era parente do famoso Velociraptor.",
                emoji: "ü¶ñ"
            },
            {
                nome: "Mesosaurus",
                tipo: "R√©ptil Aqu√°tico",
                periodo: "Permiano (299-252 milh√µes de anos)",
                local: "Brasil, √Åfrica do Sul",
                info: "R√©ptil aqu√°tico que viveu quando a Am√©rica do Sul e √Åfrica estavam unidas. Prova a deriva continental!",
                emoji: "üêä"
            },
            {
                nome: "Pterossauros",
                tipo: "R√©ptil Voador",
                periodo: "Tri√°ssico ao Cret√°ceo",
                local: "Brasil (especialmente Cear√°)",
                info: "R√©pteis voadores que dominaram os c√©us! O Brasil tem alguns dos melhores f√≥sseis de pterossauros do mundo.",
                emoji: "ü¶Ö"
            },
            {
                nome: "Trilobitas",
                tipo: "Artr√≥pode Marinho",
                periodo: "Cambriano ao Permiano",
                local: "Am√©rica do Sul",
                info: "Bichos marinhos muito antigos, extintos h√° 250 milh√µes de anos. Foram muito importantes na evolu√ß√£o da vida!",
                emoji: "ü¶Ä"
            },
            {
                nome: "Amonites",
                tipo: "Molusco",
                periodo: "Devoniano ao Cret√°ceo",
                local: "Am√©rica do Sul",
                info: "Moluscos extintos em formato de espiral. Muito comuns em rochas sedimentares!",
                emoji: "üêö"
            }
        ];

        // Quizzes por Fase
        const quizzes = {
            1: {
                pergunta: "Por que esta rocha tem camadas?",
                opcoes: [
                    { texto: "Porque esfriou r√°pido", correta: false },
                    { texto: "Porque foi se acumulando aos poucos", correta: true },
                    { texto: "Porque foi derretida", correta: false }
                ],
                feedback: "Correto! Rochas sedimentares se formam quando sedimentos (peda√ßos de rochas, restos de seres vivos) se acumulam em camadas ao longo de milh√µes de anos e s√£o prensados.",
                validacao: {
                    pergunta: "Complete: A crosta √© a camada mais _____ da Terra",
                    resposta: "externa"
                }
            },
            2: {
                pergunta: "O que acontece quando rochas sofrem calor e press√£o?",
                opcoes: [
                    { texto: "Elas derretem completamente", correta: false },
                    { texto: "Elas se transformam em rochas metam√≥rficas", correta: true },
                    { texto: "Elas viram f√≥sseis", correta: false }
                ],
                feedback: "Perfeito! Rochas metam√≥rficas se formam quando outras rochas sofrem transforma√ß√µes por calor e press√£o, mas N√ÉO derretem - apenas mudam de forma e estrutura.",
                validacao: {
                    pergunta: "Rochas metam√≥rficas se formam por:",
                    resposta: "calor e press√£o"
                }
            },
            3: {
                pergunta: "Como o magma afeta a superf√≠cie da Terra?",
                opcoes: [
                    { texto: "N√£o afeta", correta: false },
                    { texto: "Causa terremotos e vulc√µes ao mover placas tect√¥nicas", correta: true },
                    { texto: "Cria f√≥sseis", correta: false }
                ],
                feedback: "Excelente! O movimento do magma no manto empurra as placas tect√¥nicas, causando terremotos, vulc√µes e formando montanhas!",
                validacao: {
                    pergunta: "Rochas magm√°ticas se formam quando:",
                    resposta: "o magma esfria"
                }
            },
            4: {
                pergunta: "O que o campo magn√©tico da Terra faz?",
                opcoes: [
                    { texto: "Nada importante", correta: false },
                    { texto: "Protege a Terra dos ventos solares perigosos", correta: true },
                    { texto: "Cria f√≥sseis", correta: false }
                ],
                feedback: "Muito bem! O campo magn√©tico √© essencial para a vida na Terra, pois desvia part√≠culas perigosas do Sol que poderiam destruir nossa atmosfera!",
                validacao: {
                    pergunta: "O campo magn√©tico protege a Terra de:",
                    resposta: "ventos solares"
                }
            },
            5: {
                pergunta: "Por que o n√∫cleo interno √© s√≥lido se est√° t√£o quente?",
                opcoes: [
                    { texto: "Porque √© feito de material diferente", correta: false },
                    { texto: "Porque a press√£o extrema mant√©m s√≥lido", correta: true },
                    { texto: "Porque n√£o est√° quente", correta: false }
                ],
                feedback: "Perfeito! A press√£o extrema no centro da Terra √© milh√µes de vezes maior que na superf√≠cie, mantendo o metal s√≥lido mesmo a 6.000¬∞C!",
                validacao: {
                    pergunta: "O n√∫cleo interno √© s√≥lido devido √†:",
                    resposta: "press√£o extrema"
                }
            }
        };

        // Fun√ß√µes de Navega√ß√£o
        function mostrarSelecaoPersonagem() {
            document.getElementById('menu-inicial').classList.remove('ativa');
            document.getElementById('selecao-personagem').classList.add('ativa');
        }

        function selecionarPersonagem(personagem) {
            jogo.personagem = personagem;
            document.getElementById('selecao-personagem').classList.remove('ativa');
            document.getElementById('jogo').classList.add('ativa');
            atualizarHUD();
            mostrarFase(1);
            salvarProgresso();
        }

        function atualizarHUD() {
            const personagem = personagens[jogo.personagem];
            document.getElementById('info-personagem').textContent = `${personagem.emoji} ${personagem.nome}`;
            document.getElementById('fase-atual').textContent = `Fase ${jogo.faseAtual}: ${camadasTerra[jogo.faseAtual].nome}`;
        }

        function mostrarFase(numeroFase) {
            jogo.faseAtual = numeroFase;
            const fase = camadasTerra[numeroFase];
            atualizarHUD();
            
            let html = `
                <h2 class="fase-titulo">${fase.nome}</h2>
                <p class="fase-descricao">${fase.descricao}</p>
                <div style="text-align: center; margin: 20px 0; padding: 15px; background: #f0f0f0; border-radius: 8px;">
                    <strong>üå°Ô∏è Temperatura:</strong> ${fase.temperatura} | 
                    <strong>üìè Profundidade:</strong> ${fase.profundidade}
                </div>
                <h3 style="text-align: center; margin: 30px 0 20px 0;">Clique nos elementos para investigar:</h3>
                <div class="elementos-grid">
            `;

            fase.elementos.forEach(elemento => {
                const investigado = jogo.elementosInvestigados.includes(elemento.id);
                html += `
                    <div class="elemento-interativo" 
                         onclick="investigarElemento('${elemento.id}', '${fase.nome}')"
                         style="background: ${investigado ? 'linear-gradient(135deg, #28A745 0%, #20C997 100%)' : 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'};"
                         tabindex="0"
                         onkeypress="if(event.key==='Enter') investigarElemento('${elemento.id}', '${fase.nome}')">
                        <div class="emoji">${elemento.emoji}</div>
                        <h4>${elemento.nome}</h4>
                        ${investigado ? '<p style="font-size: 0.9em; margin-top: 10px;">‚úì Investigado</p>' : '<p style="font-size: 0.9em; margin-top: 10px;">Clique para investigar</p>'}
                    </div>
                `;
            });

            html += `</div>`;

            // Bot√µes de a√ß√£o
            html += `
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn" onclick="iniciarDesafioFase(${numeroFase})">üéØ Fazer Desafio da Fase</button>
                    ${numeroFase < 5 ? `<button class="btn btn-secundario" onclick="proximaFase()" id="btn-proxima-fase-${numeroFase}" style="display: none;">‚û°Ô∏è Pr√≥xima Fase</button>` : ''}
                    ${numeroFase === 5 ? `<button class="btn btn-secundario" onclick="mostrarQuizFinal()" id="btn-quiz-final" style="display: none;">üèÜ Quiz Final</button>` : ''}
                </div>
            `;

            document.getElementById('conteudo-fase').innerHTML = html;
            atualizarProgresso();
        }

        function elementoEColetavel(idElemento) {
            // Verifica se o elemento √© uma rocha ou f√≥ssil colet√°vel
            return idElemento.includes('fossil') || 
                   idElemento.includes('rocha') || 
                   idElemento.includes('marmore') || 
                   idElemento.includes('ardosia') || 
                   idElemento.includes('magmatica') || 
                   idElemento.includes('granito') || 
                   idElemento.includes('basalto');
        }

        function investigarElemento(idElemento, nomeFase) {
            const fase = camadasTerra[jogo.faseAtual];
            const elemento = fase.elementos.find(e => e.id === idElemento);
            
            if (!elemento) return;

            if (!jogo.elementosInvestigados.includes(idElemento)) {
                jogo.elementosInvestigados.push(idElemento);
            }

            // Mostrar informa√ß√£o em modal
            const modal = document.getElementById('modal-quiz');
            const conteudo = document.getElementById('quiz-conteudo');
            
            const podeColetar = elementoEColetavel(idElemento);
            
            conteudo.innerHTML = `
                <h2>${elemento.emoji} ${elemento.nome}</h2>
                <div class="feedback">
                    <p style="font-size: 1.1em;">${elemento.info}</p>
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn" onclick="fecharQuiz()">Fechar</button>
                    ${podeColetar ? 
                        `<button class="btn btn-secundario" onclick="coletarItem('${idElemento}', '${nomeFase}')">üî¨ Coletar Amostra</button>` : ''}
                </div>
            `;
            
            modal.classList.add('ativo');
            salvarProgresso();
            mostrarFase(jogo.faseAtual); // Atualizar visual
        }

        function coletarItem(idElemento, nomeFase) {
            const fase = camadasTerra[jogo.faseAtual];
            
            // Verificar se √© rocha ou f√≥ssil
            if (idElemento.includes('fossil')) {
                const fossil = fosseisSulAmericanos.find(f => 
                    idElemento.toLowerCase().includes(f.nome.toLowerCase().split(' ')[0].toLowerCase())
                );
                if (fossil && !jogo.fosseis.find(f => f.nome === fossil.nome)) {
                    jogo.fosseis.push(fossil);
                    mostrarFeedback("F√≥ssil coletado! " + fossil.nome + " foi adicionado ao seu di√°rio.");
                }
            } else if (idElemento.includes('rocha') || idElemento.includes('marmore') || idElemento.includes('ardosia') || 
                       idElemento.includes('magmatica') || idElemento.includes('granito') || idElemento.includes('basalto')) {
                let tipoRocha = 'sedimentar';
                if (idElemento.includes('marmore') || idElemento.includes('ardosia')) {
                    tipoRocha = 'metamorfica';
                } else if (idElemento.includes('magmatica') || idElemento.includes('granito') || idElemento.includes('basalto')) {
                    tipoRocha = 'magmatica';
                }
                
                const rocha = tiposRochas[tipoRocha];
                if (rocha && !jogo.amostras.find(a => a.nome === rocha.nome)) {
                    jogo.amostras.push(rocha);
                    mostrarFeedback("Amostra coletada! " + rocha.nome + " foi adicionada ao seu di√°rio.");
                }
            }
            
            fecharQuiz();
            salvarProgresso();
            atualizarDiario();
        }

        function mostrarFeedback(mensagem) {
            const feedback = document.createElement('div');
            feedback.className = 'feedback sucesso';
            feedback.style.position = 'fixed';
            feedback.style.top = '20px';
            feedback.style.right = '20px';
            feedback.style.zIndex = '2000';
            feedback.style.padding = '20px';
            feedback.style.borderRadius = '8px';
            feedback.style.boxShadow = '0 4px 6px rgba(0,0,0,0.2)';
            feedback.textContent = mensagem;
            document.body.appendChild(feedback);
            
            setTimeout(() => {
                feedback.remove();
            }, 3000);
        }

        function iniciarDesafioFase(numeroFase) {
            const quiz = quizzes[numeroFase];
            if (!quiz) return;

            const modal = document.getElementById('modal-quiz');
            const conteudo = document.getElementById('quiz-conteudo');
            // Rod√≠zio determin√≠stico das op√ß√µes: cada vez que abrir o desafio,
            // a posi√ß√£o das op√ß√µes √© deslocada (offset) por fase para evitar padr√µes.
            if (!jogo.quizOffsets) jogo.quizOffsets = {};
            const opcoesOriginais = quiz.opcoes;
            const nOpcoes = opcoesOriginais.length;
            const offsetAtual = jogo.quizOffsets[numeroFase] ?? 0;

            // Gera uma nova ordem rotacionada sem perder a propriedade `correta`
            const opcoesRotacionadas = [];
            for (let i = 0; i < nOpcoes; i++) {
                const origIndex = (i + offsetAtual) % nOpcoes;
                // copiar objeto para n√£o criar refer√™ncias inesperadas
                opcoesRotacionadas.push(Object.assign({}, opcoesOriginais[origIndex]));
            }

            // Atualiza o quiz para a vers√£o rotacionada (usado por responderQuiz)
            quiz.opcoes = opcoesRotacionadas;

            // Incrementa o offset para a pr√≥xima vez (rod√≠zio)
            jogo.quizOffsets[numeroFase] = (offsetAtual + 1) % nOpcoes;
            salvarProgresso();

            let html = `
                <h2>üéØ Desafio da Fase ${numeroFase}</h2>
                <div class="quiz-pergunta">${quiz.pergunta}</div>
                <div class="quiz-opcoes">
            `;

            quiz.opcoes.forEach((opcao, index) => {
                html += `
                    <div class="quiz-opcao" onclick="responderQuiz(${numeroFase}, ${index})" tabindex="0" onkeypress="if(event.key==='Enter') responderQuiz(${numeroFase}, ${index})">
                        ${opcao.texto}
                    </div>
                `;
            });

            html += `</div><div id="quiz-feedback"></div>`;
            conteudo.innerHTML = html;
            modal.classList.add('ativo');
        }

        function responderQuiz(numeroFase, indexOpcao) {
            const quiz = quizzes[numeroFase];
            const opcao = quiz.opcoes[indexOpcao];
            const feedbackDiv = document.getElementById('quiz-feedback');
            const opcoes = document.querySelectorAll('.quiz-opcao');
            
            opcoes.forEach((op, index) => {
                op.style.pointerEvents = 'none';
                if (quiz.opcoes[index].correta) {
                    op.classList.add('correta');
                } else if (index === indexOpcao && !opcao.correta) {
                    op.classList.add('incorreta');
                }
            });

            if (opcao.correta) {
                feedbackDiv.innerHTML = `
                    <div class="feedback sucesso">
                        <strong>üéâ Parab√©ns!</strong><br>
                        ${quiz.feedback}
                        <div style="margin-top: 15px;">
                            <button class="btn" onclick="validarConhecimento(${numeroFase})">‚û°Ô∏è Continuar</button>
                        </div>
                    </div>
                `;
            } else {
                feedbackDiv.innerHTML = `
                    <div class="feedback erro">
                        <strong>Quase l√°!</strong><br>
                        Tente novamente. Lembre-se: ${quiz.feedback.split('.')[0]}.
                        <div style="margin-top: 15px;">
                            <button class="btn" onclick="fecharQuiz(); iniciarDesafioFase(${numeroFase})">üîÑ Tentar Novamente</button>
                        </div>
                    </div>
                `;
            }
        }

        function validarConhecimento(numeroFase) {
            const quiz = quizzes[numeroFase];
            const validacao = quiz.validacao;
            
            const resposta = prompt(validacao.pergunta + "\n\n(Digite sua resposta):");
            
            if (resposta && resposta.toLowerCase().includes(validacao.resposta.toLowerCase())) {
                alert("üéâ Excelente! Voc√™ compreendeu o conceito!");
                fecharQuiz();
                
                if (!jogo.fasesCompletas.includes(numeroFase)) {
                    jogo.fasesCompletas.push(numeroFase);
                }
                
                // Mostrar bot√£o de pr√≥xima fase
                if (numeroFase < 5) {
                    document.getElementById(`btn-proxima-fase-${numeroFase}`).style.display = 'inline-block';
                } else {
                    document.getElementById('btn-quiz-final').style.display = 'inline-block';
                }
                
                adicionarConquista(`Fase ${numeroFase} Completa!`);
                salvarProgresso();
                atualizarProgresso();
            } else {
                alert("Tente novamente! A resposta cont√©m: '" + validacao.resposta + "'");
            }
        }

        function proximaFase() {
            if (jogo.faseAtual < 5) {
                jogo.faseAtual++;
                mostrarFase(jogo.faseAtual);
            } else {
                mostrarQuizFinal();
            }
        }

        function mostrarQuizFinal() {
            const perguntasOriginais = [
                { pergunta: "Qual √© a camada mais externa da Terra?", opcoes: ["Crosta", "Manto", "N√∫cleo"], correta: 0 },
                { pergunta: "Qual tipo de rocha pode conter f√≥sseis?", opcoes: ["Magm√°tica", "Sedimentar", "Metam√≥rfica"], correta: 1 },
                { pergunta: "Como se formam rochas metam√≥rficas?", opcoes: ["Magma esfria", "Calor e press√£o", "Ac√∫mulo de sedimentos"], correta: 1 },
                { pergunta: "O que o campo magn√©tico da Terra faz?", opcoes: ["Nada", "Protege dos ventos solares", "Cria f√≥sseis"], correta: 1 },
                { pergunta: "Por que o n√∫cleo interno √© s√≥lido?", opcoes: ["N√£o est√° quente", "Press√£o extrema", "√â feito de gelo"], correta: 1 },
                { pergunta: "Onde o Staurikosaurus foi encontrado?", opcoes: ["Cear√°", "Rio Grande do Sul", "S√£o Paulo"], correta: 1 },
                { pergunta: "Qual f√≥ssil prova que continentes estavam unidos?", opcoes: ["Staurikosaurus", "Glossopteris", "Trilobitas"], correta: 1 },
                { pergunta: "Qual a temperatura aproximada do n√∫cleo interno?", opcoes: ["1.000¬∞C", "3.000¬∞C", "6.000¬∞C"], correta: 2 },
                { pergunta: "O movimento do magma causa:", opcoes: ["F√≥sseis", "Terremotos e vulc√µes", "Campo magn√©tico"], correta: 1 },
                { pergunta: "Rochas magm√°ticas se formam quando:", opcoes: ["Sedimentos se acumulam", "Magma esfria", "Rochas sofrem press√£o"], correta: 1 }
            ];

            // Fun√ß√£o para embaralhar array (Fisher-Yates)
            function embaralharArray(array) {
                const novoArray = [...array];
                for (let i = novoArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [novoArray[i], novoArray[j]] = [novoArray[j], novoArray[i]];
                }
                return novoArray;
            }

            // Embaralhar op√ß√µes de cada pergunta e ajustar √≠ndice correto
            const perguntas = perguntasOriginais.map(pergunta => {
                const respostaCorreta = pergunta.opcoes[pergunta.correta];
                const opcoesEmbaralhadas = embaralharArray(pergunta.opcoes);
                const novoIndiceCorreto = opcoesEmbaralhadas.indexOf(respostaCorreta);
                
                return {
                    pergunta: pergunta.pergunta,
                    opcoes: opcoesEmbaralhadas,
                    correta: novoIndiceCorreto
                };
            });

            let html = `<h2>üèÜ Quiz Final - Teste Seu Conhecimento!</h2>`;
            let acertos = 0;
            let total = perguntas.length;

            perguntas.forEach((pergunta, index) => {
                html += `
                    <div style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                        <strong>${index + 1}. ${pergunta.pergunta}</strong>
                        <div class="quiz-opcoes" style="margin-top: 10px;">
                `;
                pergunta.opcoes.forEach((opcao, opIndex) => {
                    html += `
                        <div class="quiz-opcao" onclick="responderQuizFinal(${index}, ${opIndex}, ${pergunta.correta})">
                            ${opcao}
                        </div>
                    `;
                });
                html += `</div><div id="feedback-${index}"></div></div>`;
            });

            html += `
                <div id="resultado-final" style="display: none; text-align: center; margin-top: 30px;">
                    <h2 id="nota-final"></h2>
                    <button class="btn" onclick="mostrarTelaFinal()">üéâ Ver Certificado</button>
                </div>
            `;

            const modal = document.getElementById('modal-quiz');
            const conteudo = document.getElementById('quiz-conteudo');
            conteudo.innerHTML = html;
            modal.classList.add('ativo');

            window.responderQuizFinal = function(perguntaIndex, opcaoIndex, correta) {
                const feedbackDiv = document.getElementById(`feedback-${perguntaIndex}`);
                if (!feedbackDiv) return;
                
                // Verificar se j√° foi respondida (evitar m√∫ltiplos cliques)
                if (feedbackDiv.innerHTML.trim() !== '') return;
                
                // Encontrar o container da pergunta (parent do feedbackDiv)
                const containerPergunta = feedbackDiv.parentElement;
                // Encontrar as op√ß√µes dentro do container
                const todasOpcoes = containerPergunta.querySelectorAll('.quiz-opcao');
                
                // Desabilitar cliques e marcar respostas
                todasOpcoes.forEach((op, idx) => {
                    op.style.pointerEvents = 'none';
                    if (idx === correta) {
                        op.classList.add('correta');
                    } else if (idx === opcaoIndex && idx !== correta) {
                        op.classList.add('incorreta');
                    }
                });

                if (opcaoIndex === correta) {
                    acertos++;
                    feedbackDiv.innerHTML = '<div class="feedback sucesso">‚úì Correto!</div>';
                } else {
                    feedbackDiv.innerHTML = '<div class="feedback erro">‚úó Incorreto. A resposta correta est√° destacada em verde.</div>';
                }

                // Verificar se todas foram respondidas
                setTimeout(() => {
                    // Verificar se todos os feedbacks t√™m conte√∫do (foram respondidos)
                    let todasRespondidas = true;
                    for (let i = 0; i < perguntas.length; i++) {
                        const fb = document.getElementById(`feedback-${i}`);
                        if (!fb || fb.innerHTML.trim() === '') {
                            todasRespondidas = false;
                            break;
                        }
                    }
                    
                    if (todasRespondidas) {
                        const resultado = document.getElementById('resultado-final');
                        const nota = document.getElementById('nota-final');
                        if (resultado && nota) {
                            resultado.style.display = 'block';
                            const porcentagem = Math.round((acertos / total) * 100);
                            nota.textContent = `Voc√™ acertou ${acertos} de ${total} quest√µes (${porcentagem}%)!`;
                            
                            if (porcentagem >= 70) {
                                nota.style.color = 'var(--success-color)';
                            } else {
                                nota.style.color = 'var(--warning-color)';
                            }
                        }
                    }
                }, 100);
            };
        }

        function mostrarTelaFinal() {
            fecharQuiz();
            document.getElementById('jogo').classList.remove('ativa');
            
            const telaFinal = document.createElement('div');
            telaFinal.className = 'tela ativa';
            telaFinal.id = 'tela-final';
            telaFinal.innerHTML = `
                <div class="tela-final">
                    <h1>üéâ Parab√©ns, Cientista!</h1>
                    <p style="font-size: 1.2em; margin-bottom: 30px;">Voc√™ completou sua viagem ao centro da Terra!</p>
                    
                    <div class="certificado">
                        <h2>üèÖ Certificado de Conclus√£o</h2>
                        <p style="font-size: 1.3em; margin: 20px 0;">
                            ${personagens[jogo.personagem].nome}
                        </p>
                        <p>Completou com sucesso a investiga√ß√£o cient√≠fica das camadas da Terra, tipos de rochas e f√≥sseis sul-americanos.</p>
                        <p style="margin-top: 20px; font-size: 0.9em;">Habilidades desenvolvidas: EF06CI11 e EF06CI12 (BNCC)</p>
                    </div>

                    <div style="margin: 40px 0;">
                        <h3>üìä Seu Progresso:</h3>
                        <p>‚úÖ Fases completas: ${jogo.fasesCompletas.length}/5</p>
                        <p>üî¨ Amostras coletadas: ${jogo.amostras.length}</p>
                        <p>ü¶ï F√≥sseis descobertos: ${jogo.fosseis.length}</p>
                        <p>üèÜ Conquistas: ${jogo.conquistas.length}</p>
                    </div>

                    <div style="margin: 40px 0;">
                        <button class="btn" onclick="mostrarGaleriaFosseis()">ü¶ï Galeria de F√≥sseis</button>
                        <button class="btn btn-secundario" onclick="recomecarJogo()">üîÑ Jogar Novamente</button>
                    </div>
                </div>
            `;
            
            document.getElementById('game-container').appendChild(telaFinal);
            adicionarConquista("Cientista Completo!");
        }

        function mostrarGaleriaFosseis() {
            const modal = document.getElementById('modal-quiz');
            const conteudo = document.getElementById('quiz-conteudo');
            
            let html = `
                <h2>ü¶ï Galeria de F√≥sseis Sul-Americanos</h2>
                <p style="text-align: center; margin-bottom: 30px;">Explore os f√≥sseis encontrados na Am√©rica do Sul!</p>
                <div class="fossil-grid">
            `;

            fosseisSulAmericanos.forEach(fossil => {
                const descoberto = jogo.fosseis.find(f => f.nome === fossil.nome);
                html += `
                    <div class="fossil-card" style="border: ${descoberto ? '3px solid var(--success-color)' : '1px solid #ddd'};">
                        <div class="emoji">${fossil.emoji}</div>
                        <h3>${fossil.nome}</h3>
                        <p><strong>Tipo:</strong> ${fossil.tipo}</p>
                        <p><strong>Per√≠odo:</strong> ${fossil.periodo}</p>
                        <p><strong>Local:</strong> ${fossil.local}</p>
                        <p style="margin-top: 10px; font-size: 0.9em;">${fossil.info}</p>
                        ${descoberto ? '<p style="color: var(--success-color); margin-top: 10px;">‚úì Descoberto!</p>' : ''}
                    </div>
                `;
            });

            html += `</div>
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn" onclick="fecharQuiz()">Fechar</button>
                </div>
            `;

            conteudo.innerHTML = html;
            modal.classList.add('ativo');
        }

        // Sistema de Di√°rio
        function abrirDiario() {
            atualizarDiario();
            document.getElementById('modal-diario').classList.add('ativo');
        }

        function fecharDiario() {
            document.getElementById('modal-diario').classList.remove('ativo');
        }

        function mostrarAbaDiario(aba) {
            document.querySelectorAll('.diario-aba').forEach(a => a.classList.remove('ativa'));
            event.target.classList.add('ativa');
            atualizarDiario(aba);
        }

        function atualizarDiario(abaAtiva = 'descobertas') {
            const conteudo = document.getElementById('diario-conteudo');
            
            if (abaAtiva === 'descobertas') {
                let html = '<h3>üìù Minhas Descobertas</h3>';
                html += `<p><strong>Fases Completas:</strong> ${jogo.fasesCompletas.length}/5</p>`;
                html += `<p><strong>Elementos Investigados:</strong> ${jogo.elementosInvestigados.length}</p>`;
                html += '<h4 style="margin-top: 20px;">Camadas Visitadas:</h4><ul>';
                jogo.fasesCompletas.forEach(fase => {
                    html += `<li>${camadasTerra[fase].nome}</li>`;
                });
                html += '</ul>';
                conteudo.innerHTML = html;
            } else if (abaAtiva === 'amostras') {
                let html = '<h3>üî¨ Amostras Coletadas</h3>';
                if (jogo.amostras.length === 0) {
                    html += '<p>Nenhuma amostra coletada ainda. Continue investigando!</p>';
                } else {
                    jogo.amostras.forEach(amostra => {
                        html += `
                            <div class="amostra-item">
                                <h4>${amostra.emoji} ${amostra.nome}</h4>
                                <p><strong>Forma√ß√£o:</strong> ${amostra.formacao}</p>
                                <p><strong>Exemplos:</strong> ${amostra.exemplos.join(', ')}</p>
                                <p><strong>Cont√©m f√≥sseis:</strong> ${amostra.temFosseis ? 'Sim ‚úì' : 'N√£o'}</p>
                            </div>
                        `;
                    });
                }
                html += '<h4 style="margin-top: 30px;">ü¶ï F√≥sseis Coletados</h4>';
                if (jogo.fosseis.length === 0) {
                    html += '<p>Nenhum f√≥ssil coletado ainda. Procure em rochas sedimentares!</p>';
                } else {
                    jogo.fosseis.forEach(fossil => {
                        html += `
                            <div class="amostra-item">
                                <h4>${fossil.emoji} ${fossil.nome}</h4>
                                <p><strong>Tipo:</strong> ${fossil.tipo}</p>
                                <p><strong>Per√≠odo:</strong> ${fossil.periodo}</p>
                                <p><strong>Local:</strong> ${fossil.local}</p>
                                <p>${fossil.info}</p>
                            </div>
                        `;
                    });
                }
                conteudo.innerHTML = html;
            } else if (abaAtiva === 'mapa') {
                let html = '<h3>üó∫Ô∏è Mapa das Camadas</h3>';
                html += '<div style="text-align: center; margin: 20px 0;">';
                for (let i = 1; i <= 5; i++) {
                    const fase = camadasTerra[i];
                    const completa = jogo.fasesCompletas.includes(i);
                    html += `
                        <div style="padding: 20px; margin: 10px 0; background: ${fase.cor}; color: white; border-radius: 8px; ${completa ? 'border: 3px solid var(--success-color);' : ''}">
                            <h4>${completa ? '‚úì' : ''} ${fase.nome}</h4>
                            <p>${fase.profundidade} | ${fase.temperatura}</p>
                        </div>
                    `;
                }
                html += '</div>';
                conteudo.innerHTML = html;
            } else if (abaAtiva === 'glossario') {
                let html = '<h3>üìö Gloss√°rio Cient√≠fico</h3>';
                html += `
                    <div class="amostra-item">
                        <h4>üåç Crosta Terrestre</h4>
                        <p>A camada mais externa e fina da Terra, onde vivemos.</p>
                    </div>
                    <div class="amostra-item">
                        <h4>üåã Manto</h4>
                        <p>Camada intermedi√°ria, mais espessa, onde rochas se movem e se transformam.</p>
                    </div>
                    <div class="amostra-item">
                        <h4>üíé N√∫cleo</h4>
                        <p>Camada mais interna, formada por ferro e n√≠quel. Cria o campo magn√©tico.</p>
                    </div>
                    <div class="amostra-item">
                        <h4>ü™® Rocha Sedimentar</h4>
                        <p>Formada por ac√∫mulo de sedimentos. √öNICA rocha que cont√©m f√≥sseis!</p>
                    </div>
                    <div class="amostra-item">
                        <h4>ü™® Rocha Metam√≥rfica</h4>
                        <p>Formada quando outras rochas sofrem transforma√ß√µes por calor e press√£o.</p>
                    </div>
                    <div class="amostra-item">
                        <h4>ü™® Rocha Magm√°tica</h4>
                        <p>Formada quando o magma esfria e endurece.</p>
                    </div>
                    <div class="amostra-item">
                        <h4>ü¶ï F√≥ssil</h4>
                        <p>Restos ou vest√≠gios de seres vivos antigos preservados em rochas sedimentares.</p>
                    </div>
                    <div class="amostra-item">
                        <h4>üß≤ Campo Magn√©tico</h4>
                        <p>Campo criado pelo n√∫cleo externo que protege a Terra dos ventos solares.</p>
                    </div>
                `;
                conteudo.innerHTML = html;
            }
        }

        // Sistema de Progresso
        function atualizarProgresso() {
            const totalElementos = 20; // Aproximado
            const elementosInvestigados = jogo.elementosInvestigados.length;
            const fasesCompletas = jogo.fasesCompletas.length;
            const progresso = Math.round(((fasesCompletas * 20) + (elementosInvestigados * 2)) / 100 * 100);
            
            jogo.progresso = Math.min(progresso, 100);
            document.getElementById('progresso-bar').style.width = jogo.progresso + '%';
            document.getElementById('progresso-bar').textContent = jogo.progresso + '%';
        }

        function adicionarConquista(nome) {
            if (!jogo.conquistas.includes(nome)) {
                jogo.conquistas.push(nome);
                mostrarFeedback("üèÜ Conquista desbloqueada: " + nome);
                salvarProgresso();
            }
        }

        // Sistema de Salvamento
        function salvarProgresso() {
            localStorage.setItem('viagemCentroTerra', JSON.stringify(jogo));
        }

        function carregarJogoSalvo() {
            const salvo = localStorage.getItem('viagemCentroTerra');
            if (salvo) {
                jogo = JSON.parse(salvo);
                document.getElementById('menu-inicial').classList.remove('ativa');
                document.getElementById('jogo').classList.add('ativa');
                atualizarHUD();
                mostrarFase(jogo.faseAtual);
            }
        }

        function recomecarJogo() {
            if (confirm('Tem certeza que deseja apagar todo o progresso e come√ßar de novo?')) {
                localStorage.removeItem('viagemCentroTerra');
                location.reload();
            }
        }

        // Acessibilidade
        function abrirOpcoes() {
            document.getElementById('modal-opcoes').classList.add('ativo');
        }

        function fecharOpcoes() {
            document.getElementById('modal-opcoes').classList.remove('ativo');
        }

        function toggleAltoContraste() {
            document.body.classList.toggle('alto-contraste');
            salvarProgresso();
        }

        function ajustarFonte(tamanho) {
            document.body.className = document.body.className.replace(/fonte-\w+/g, '');
            if (tamanho !== 'media') {
                document.body.classList.add('fonte-' + tamanho);
            }
            salvarProgresso();
        }

        function fecharQuiz() {
            document.getElementById('modal-quiz').classList.remove('ativo');
        }

        // Fechar modais com ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                fecharDiario();
                fecharQuiz();
                fecharOpcoes();
            }
        });

        // Inicializa√ß√£o
        window.onload = function() {
            const salvo = localStorage.getItem('viagemCentroTerra');
            if (salvo) {
                document.getElementById('btn-continuar').style.display = 'inline-block';
            }
            
            // Carregar prefer√™ncias
            const preferencias = localStorage.getItem('preferencias');
            if (preferencias) {
                const pref = JSON.parse(preferencias);
                if (pref.altoContraste) {
                    document.body.classList.add('alto-contraste');
                    document.getElementById('toggle-contraste').checked = true;
                }
                if (pref.fonte) {
                    ajustarFonte(pref.fonte);
                }
            }
        };

        // Salvar prefer√™ncias
        document.getElementById('toggle-contraste')?.addEventListener('change', function() {
            const preferencias = {
                altoContraste: this.checked,
                fonte: document.body.className.match(/fonte-(\w+)/)?.[1] || 'media'
            };
            localStorage.setItem('preferencias', JSON.stringify(preferencias));
        });
    </script>
</body>
</html>


